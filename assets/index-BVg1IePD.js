import{j as a}from"./index-CM8xp5W3.js";import{r as u,R as m}from"./react-vendor-C7qxa2PD.js";import{u as f}from"./index-ucXmJ9nZ.js";import{d as g,e as w,f as x,h as R,u as y,l as C,c as S,b as j,P as v}from"./index-VavuTpL6.js";import{c as N}from"./antd-DPo7ARJh.js";import{u as E}from"./useResizeDom--g2n-OkL.js";import"./monaco-editor-DFCLNRsn.js";import"./ahooks-CSAi6c6A.js";import"./lodash-es-CdGItEyc.js";import"./useListenRef-BncaX_Rk.js";import"./useEffectOnce-BgFV88FQ.js";import"./hotkeys.esm-C5d8raBv.js";function H(e){const[n,t]=u.useState(e==null?void 0:e.componentNode),r=(n==null?void 0:n.show)??!0,{engine:i}=f(),o=u.useMemo(()=>i.component.get(n.cId),[n==null?void 0:n.cId,e==null?void 0:e.packages]);return u.useEffect(()=>i.componentNode.onChange(n.id,({payload:s})=>{t({...s})}),[]),o&&r?a.jsx(q,{componentNode:n,component:o}):a.jsx(a.Fragment,{})}function q(e){const{component:n,componentNode:t}=e,r=u.useRef(),i=u.useRef(null),{dataSource:o,requestInstance:s}=g(t),l=w(t.id),c=x(t.id);return R({id:t.id,handleHover(){},handleUnHover(){},handleSelected(){},handleUnSelected(){},getContainerDom(){return i.current},getComponentNode(){return r.current},getComponent(){return n},reloadRequest(){s.reload()},request:(d,h)=>s.request(d,h)}),a.jsx("div",{ref:i,style:{position:"absolute",left:t.x,top:t.y,width:t.width,height:t.height,zIndex:t.level},children:a.jsx(u.Suspense,{children:a.jsx(n.component,{handleTrigger:l,useExpose:c,dataSource:o,componentNode:t,options:t.options,width:t.width,height:t.height})})})}const B="_fitScreenBody_1qzud_59",P={fitScreenBody:B};function _(e){const{dw:n=1920,dh:t=1080}=e,r=u.useRef(null),i=u.useRef(null),o=u.useMemo(()=>n/t,[n,t]);return E(r,()=>{if(!r.current||!i.current)return;const s=r.current.getBoundingClientRect();if(s.width/s.height>o){const c=s.height/t,d=c*n,h=(s.width-d)/2;i.current.style.transform=`scale(${c}) translate3d(${h/c}px, 0, 0)`}else{const c=s.width/n;i.current.style.transform=`scale(${c})`}i.current.style.width=`${n}px`,i.current.style.height=`${t}px`}),a.jsx("div",{className:e==null?void 0:e.className,ref:r,style:e==null?void 0:e.style,children:a.jsx("div",{className:N(e==null?void 0:e.bodyClassName,P.fitScreenBody),style:e==null?void 0:e.bodyStyle,ref:i,children:e==null?void 0:e.children})})}const $="_preview_x6h89_59",b={preview:$};function A(e){const{engine:n,json:t}=e,r=y(),{options:i}=C()||{},o=S(),s=j(),l=u.useMemo(()=>{var c;return o.length?(c=s==null?void 0:s.map)==null?void 0:c.call(s,d=>a.jsx(H,{componentNode:d,packages:o},d==null?void 0:d.id)):[]},[s,o]);return m.useEffect(()=>{n.loadJSON(t).then(()=>{var c;(c=e==null?void 0:e.onJSONLoad)==null||c.call(e)})},[]),a.jsx(_,{className:b.preview,dw:(r==null?void 0:r.width)||1920,dh:(r==null?void 0:r.height)||1080,style:{background:i==null?void 0:i.whiteBoardColor},children:a.jsx(v,{preview:!0,style:{width:"100%",height:"100%"},children:l})})}export{A as default};
